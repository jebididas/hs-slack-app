<!DOCTYPE html>
<html>
<head>
	<title>Auth</title>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>
<script type="text/javascript">
  function getParameterByName(name) {  // This decodes and separates the URI into pieces
      name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
      return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }

  var redirect_uri = getParameterByName('complete');
  if(redirect_uri === '1'){
    console.log('complete equals 1');
    window.opener.location.reload();
  }

  var code = getParameterByName('code');


  $.ajax({
    method: "POST",
    url: "https://slack.com/api/oauth.access?client_id=10392449395.10392827204&client_secret=1a081084c53d5acd8737c8e1427bb958&code="
    		+ code 
    		+ "&pretty=1",
    error: function(response, err){ console.log('Auth Post Request: ' + err) }, 
    success: function(response) { 
    	localStorage.setItem('slack_access_token', response.access_token);
    	localStorage.setItem('slack_team_name', response.team_name);
      close();
    }
  });	
</script>
</body>
</html>